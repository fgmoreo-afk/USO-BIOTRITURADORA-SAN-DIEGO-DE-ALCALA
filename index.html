<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor BIO150S - IES San Diego de Alcal치</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #004085; --danger: #dc3545; --success: #28a745; --warning: #ffc107; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 10px; display: flex; justify-content: center; }
        .container { background: white; width: 100%; max-width: 600px; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .header { text-align: center; border-bottom: 3px solid var(--primary); margin-bottom: 15px; }
        .checklist-sec { background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #ffeeba; font-size: 0.9em; }
        .checklist-item { display: flex; align-items: center; margin-bottom: 8px; cursor: pointer; }
        .checklist-item input { margin-right: 10px; transform: scale(1.2); }
        .timer-box { background: #1a1a1a; color: #00ff00; font-family: monospace; font-size: 3rem; text-align: center; padding: 15px; border-radius: 10px; margin: 15px 0; border: 4px solid #333; }
        .btn { padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; color: white; margin-bottom: 10px; font-size: 1rem; }
        .btn-start { background: var(--success); }
        .btn-start:disabled { background: #ccc; cursor: not-allowed; }
        .btn-stop { background: var(--danger); display: none; }
        .btn-incident { background: var(--warning); color: #000; }
        .btn-pdf { background: var(--primary); }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; font-size: 0.8em; margin-bottom: 15px; }
        input[type="text"] { padding: 12px; width: 100%; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2 style="margin: 5px 0;">IES San Diego de Alcal치</h2>
        <p style="margin: 5px 0; color: #666;">Control Biotrituradora BIO150S</p>
    </div>
    <input type="text" id="profesorName" placeholder="Nombre del Profesor Responsable" oninput="validate()">
    <div class="checklist-sec" id="checklist">
        <strong>游늶 Checklist Obligatorio (Manual ANOVA):</strong>
        <label class="checklist-item"><input type="checkbox" onchange="validate()"> Aceite verificado (1.2L 10W-30)</label>
        <label class="checklist-item"><input type="checkbox" onchange="validate()"> Cojinetes engrasados (Litio)</label>
        <label class="checklist-item"><input type="checkbox" onchange="validate()"> Torniller칤a revisada</label>
        <label class="checklist-item"><input type="checkbox" onchange="validate()"> 츼rea segura (15m distancia)</label>
        <label class="checklist-item"><input type="checkbox" onchange="validate()"> Alumnos con gafas y botas</label>
    </div>
    <div class="timer-box" id="timer">00:00:00</div>
    <button class="btn btn-start" id="startBtn" onclick="startTimer()" disabled>DESBLOQUEAR Y TRABAJAR</button>
    <button class="btn btn-stop" id="stopBtn" onclick="stopTimer()">FINALIZAR Y GUARDAR</button>
    <button class="btn btn-incident" onclick="reportIncident()">丘멆잺 REGISTRAR INCIDENCIA</button>
    <div class="stats">
        <div>Total Horas<br><strong id="totalHours">0.00</strong></div>
        <div>Pr칩x. Aceite<br><strong id="oilDue">0.00</strong></div>
        <div>Buj칤a (100h)<br><strong id="sparkDue">0.00</strong></div>
    </div>
    <button class="btn btn-pdf" onclick="generatePDF()">DESCARGAR REPORTE PDF</button>
</div>
<script>
    const { jsPDF } = window.jspdf;
    let timerInterval, startTime;
    let data = JSON.parse(localStorage.getItem('bio_ies_sd')) || { total: 0, lastOil: 0, history: [], incidents: [] };
    function validate() {
        const checks = document.querySelectorAll('#checklist input[type="checkbox"]');
        const allChecked = Array.from(checks).every(c => c.checked);
        const name = document.getElementById('profesorName').value.trim();
        document.getElementById('startBtn').disabled = !(allChecked && name.length > 3);
    }
    function startTimer() {
        startTime = Date.now();
        document.getElementById('startBtn').style.display = "none";
        document.getElementById('profesorName').disabled = true;
        document.getElementById('checklist').style.opacity = "0.5";
        document.getElementById('stopBtn').style.display = "block";
        timerInterval = setInterval(() => {
            let diff = Date.now() - startTime;
            let h = Math.floor(diff / 3600000);
            let m = Math.floor((diff % 3600000) / 60000);
            let s = Math.floor((diff % 60000) / 1000);
            document.getElementById('timer').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }, 1000);
    }
    function stopTimer() {
        clearInterval(timerInterval);
        let sessionHours = (Date.now() - startTime) / 3600000;
        data.total += sessionHours;
        data.history.push({ prof: document.getElementById('profesorName').value, fecha: new Date().toLocaleString(), horas: sessionHours.toFixed(2) });
        localStorage.setItem('bio_ies_sd', JSON.stringify(data));
        location.reload();
    }
    function reportIncident() {
        const tipo = prompt("Describa el problema:");
        if(tipo) {
            data.incidents.push({ prof: document.getElementById('profesorName').value || "N/A", tipo, fecha: new Date().toLocaleString() });
            localStorage.setItem('bio_ies_sd', JSON.stringify(data));
            alert("Incidencia registrada.");
        }
    }
    function generatePDF() {
        const doc = new jsPDF();
        doc.setFontSize(16);
        doc.text("REPORTE BIO150S - IES SAN DIEGO DE ALCAL츼", 20, 20);
        doc.setFontSize(10);
        doc.text(`Horas totales de m치quina: ${data.total.toFixed(2)} h`, 20, 35);
        let y = 60;
        data.incidents.slice(-10).forEach(i => { doc.text(`- ${i.fecha} [${i.prof}]: ${i.tipo}`, 25, y); y += 7; });
        doc.save("reporte-bio150s-ies.pdf");
    }
    function init() {
        document.getElementById('totalHours').innerText = data.total.toFixed(2);
        let nextOil = data.lastOil === 0 ? 5 : data.lastOil + 25;
        document.getElementById('oilDue').innerText = nextOil.toFixed(2) + "h";
        document.getElementById('sparkDue').innerText = (100 - (data.total % 100)).toFixed(2) + "h";
    }
    init();
</script>
</body>
</html>
